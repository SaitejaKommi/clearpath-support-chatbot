<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Clearpath Support Chatbot</title>
    <style>
        :root{
            --bg-1: #0f1724;
            --bg-2: #071328;
            --card: rgba(255,255,255,0.04);
            --accent: #06b6d4;
            --accent-2: #7c3aed;
            --user-bg: linear-gradient(135deg,#60a5fa,#1e40af);
            --bot-bg: linear-gradient(180deg,#ffffff,#eef2ff);
            --muted: #9ca3af;
            --max-width: 980px;
        }

        *{box-sizing:border-box}
        html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#e6eef8;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));}

        .container{
            max-width:var(--max-width);
            margin:28px auto;
            padding:20px;
            border-radius:14px;
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            box-shadow:0 10px 30px rgba(2,6,23,0.6);
            display:flex;
            flex-direction:column;
            gap:14px;
            min-height:70vh;
        }

        /* Header */
        .header{
            display:flex;
            align-items:center;
            gap:14px;
            padding:6px 4px;
        }
        .logo{
            width:56px;height:56px;border-radius:12px;
            background:linear-gradient(135deg,var(--accent-2),var(--accent));
            display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px;
            box-shadow:0 8px 26px rgba(124,58,237,0.12);
        }
        .title-wrap{flex:1;text-align:center;transform:translateX(6%);} /* slightly right of center */
        h1{font-size:1.25rem;margin:0;letter-spacing:0.2px}
        .subtitle{font-size:0.85rem;color:var(--muted);margin-top:6px}

        /* Chat area */
        .chat {
            display:flex;
            flex-direction:column;
            gap:10px;
            background:var(--card);
            border-radius:12px;
            padding:14px;
            flex:1;
            min-height:360px;
            overflow:hidden;
        }

        #chat{
            overflow-y:auto;
            padding:6px;
            display:flex;
            flex-direction:column;
            gap:10px;
        }

        .message{max-width:78%;padding:12px;border-radius:12px;line-height:1.4;box-shadow:0 6px 18px rgba(2,6,23,0.35);}
        .user{align-self:flex-end;background:var(--user-bg);color:white;border-bottom-right-radius:4px;text-align:right}
        .bot{align-self:flex-start;background:var(--bot-bg);color:#0b1220;border-bottom-left-radius:4px}

        /* Composer */
        .composer{display:flex;gap:10px;align-items:center;padding-top:6px}
        #input{flex:1;padding:12px 14px;border-radius:999px;border:0;outline:none;background:rgba(255,255,255,0.02);color:inherit;font-size:1rem}
        button{padding:10px 18px;border-radius:999px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;font-weight:600;cursor:pointer;box-shadow:0 8px 22px rgba(6,182,212,0.12)}
        button:active{transform:translateY(1px)}

        /* Debug */
        #debug{margin-top:8px;background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;color:var(--muted);font-size:13px;display:flex;gap:18px;align-items:center;flex-wrap:wrap}

        /* Responsive */
        @media (max-width:720px){
            .container{margin:12px;padding:12px;border-radius:10px}
            .logo{width:48px;height:48px}
            .title-wrap{transform:translateX(4%)}
            .message{max-width:92%}
            h1{font-size:1.05rem}
            #chat{min-height:260px}
            .composer{flex-direction:row}
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header" role="banner">
            <div class="logo">CP</div>
            <div class="title-wrap">
                <h1>Clearpath Support Chat</h1>
                <div class="subtitle">Answers sourced from your documentation — concise and accurate.</div>
            </div>
        </header>

        <main class="chat" role="main" aria-live="polite">
            <div id="chat"></div>

            <div class="composer" role="region" aria-label="Message composer">
                <input id="input" type="text" placeholder="Ask a question..." aria-label="Message input">
                <button onclick="sendMessage()">Send</button>
            </div>
        </main>

        <div id="debug">
            <strong>Debug Info:</strong>
            <div>Model: <span id="debug-model">-</span></div>
            <div>Tokens: <span id="debug-tokens">-</span></div>
            <div>Reliability: <span id="debug-reliability">-</span></div>
        </div>
    </div>

    <script>
        async function sendMessage() {
            const input = document.getElementById('input').value;
            document.getElementById('input').value = '';
            
            // Show user message
            addMessage(input, 'user');
            
            // Call backend
            const response = await fetch('https://clearpath-support-chatbot.onrender.com/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: input })
            });
            
            const data = await response.json();
            
            // Show bot response
            let botMsg = data.response || "⚠️ Server error occurred.";
            if (!data.is_reliable) {
                botMsg += "\n\n⚠️ Low confidence — please verify with support.";
            }
            addMessage(botMsg, 'bot');
            
            // Update debug panel
            document.getElementById('debug-model').textContent = data.model_used;
            document.getElementById('debug-tokens').textContent = 
                `${data.tokens_input} in, ${data.tokens_output} out`;
            document.getElementById('debug-reliability').textContent = 
                data.is_reliable ? '✓ Reliable' : '✗ Flagged';
        }
        
        function addMessage(text, sender) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.textContent = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }
    </script>
</body>
</html>